<link rel="stylesheet" href="https://cdn.fluidplayer.com/v2/current/fluidplayer.min.css" type="text/css" />
<script src="https://cdn.fluidplayer.com/v2/current/fluidplayer.min.js"></script>
<style>
    .fluid_video_wrapper {
        -webkit-transition: width 3s, height 3s;
        /* Safari */
        transition: width 3s, height 3s;
    }
</style>

<div class="wrapper" id="wrapper" style="width:600px;height:400px;">
    <video id="video-id">
        <source src="video.mp4" type="video/mp4" />
    </video>
</div>

<script>
    var firstPlay = true
    var completedTransition = false
    var completedAd = false

    var destroyPlayer = function (idVideoPlayer) {
        for (var i = 0; i < fluidPlayerClass.instances.length; i++) {
            if (fluidPlayerClass.instances[i].videoPlayerId === idVideoPlayer) {
                var videoWrapper = document.getElementById('fluid_video_wrapper_' + idVideoPlayer);
                var oldPlayer = document.getElementById(idVideoPlayer);
                var newPlayer = oldPlayer.cloneNode(true);
                videoWrapper.innerHTML = '';
                newPlayer.removeAttribute('src');
                videoWrapper.parentNode.replaceChild(newPlayer, videoWrapper);
                videoWrapper = null;
                oldPlayer = null;

                //Kill instance
                fluidPlayerClass.instances[i] = {
                    videoPlayerId: '83748374hjkehwkfjrweqh8724983278983k'
                };

                break;
            }
        }
    };

    var hidePlayerButtons = function () {
        var hide = "display:none"

        var fullscreen = document.getElementById('video-id_fluid_control_fullscreen')
        fullscreen.style = hide
        var theatre = document.getElementById('video-id_fluid_control_theatre')
        theatre.style = hide
        var progress = document.getElementById('video-id_fluid_control_duration')
        progress.style = hide
    }

    var showPlayerButtons = function () {
        var show = "display:block"

        var fullscreen = document.getElementById('video-id_fluid_control_fullscreen')
        fullscreen.style = show
        var theatre = document.getElementById('video-id_fluid_control_theatre')
        theatre.style = show
        var progress = document.getElementById('video-id_fluid_control_duration')
        progress.style = show
    }

    var removeAllListener = function () {
        wrapper.removeEventListener("mouseleave", playerOut)
        wrapper.removeEventListener("mouseenter", playerIn)
    }

    var playerOut = function () {
        var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
        // si no ha terminado la transicion, vuelve al tamaño inicial
        if (!completedTransition) {
            video_wrapper.style.width = "600px"
            video_wrapper.style.height = "400px"
        }
    }

    var playerIn = function () {
        var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
        video_wrapper.style.width = "300px"
        video_wrapper.style.height = "200px"
    }

    var options = {
        vastOptions: {
            adList: [{
                roll: "preRoll",
                vastTag: "vast.xml",
                adClickable: false
            }],
            vastAdvanced: {
                vastLoadedCallback: (function () {
                    // quitamos los botones que no necesitamos
                    hidePlayerButtons()
                }),
                noVastVideoCallback: (function () {}),
                vastVideoSkippedCallback: (function () {}),
                vastVideoEndedCallback: (function () {
                    if (completedTransition) {
                        destroyPlayer('video-id')
                        resetPlayer()
                    } else {
                        removeAllListener()
                        showPlayerButtons()
                        completedAd = true
                    }
                })
            }
        },
        layoutControls: {
            autoPlay: true
        },
        layoutControls: {
            playerInitCallback: (function () {
                // obtenemos el contenedor del reproductor
                var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')

                // si el reproductor ya se achicó en el siguiente bucle mantendra el tamaño
                if (!completedTransition) {
                    video_wrapper.style = "position: absolute;width: 600px;height: 400px;"
                } else {
                    video_wrapper.style = "position: absolute;width: 300px;height: 200px;"
                }

                // si el primer bucle, agregamos el HTML del fondo
                if (firstPlay) {
                    var background = document.createElement('div')
                    background.style = "background:gray;width:600px;height:400px"
                    wrapper.appendChild(background)
                }

                // agregamos el listener para cuando termine de achicarse
                video_wrapper.addEventListener("transitionend", function (event) {
                    if (event.propertyName === "width") {
                        if (event.elapsedTime > 2.8) {
                            completedTransition = true
                        }
                    }
                });

                // agregamos el listener para cuando el mouse salga del reproductor
                wrapper.addEventListener("mouseleave", playerOut)

                firstPlay = false
            })
        }
    }

    var video = fluidPlayer("video-id", options);

    var resetPlayer = function () {
        // iniciamos una nueva instancia del reproductor
        fluidPlayer('video-id', options);
    };

    video.on('play', function () {
        if (!completedAd) {
            var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
            // agregamos el listener para cuando el mouse este dentro de reproductor
            wrapper.addEventListener("mouseenter", playerIn);
        }
    })
</script>