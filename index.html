<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.fluidplayer.com/v2/current/fluidplayer.min.css" type="text/css" />
    <script src="fluidplayer.js"></script>
    <style>
        .fluid_video_wrapper {
            -webkit-transition: width 3s, height 3s, margin 3s;
            transition: width 3s, height 3s, margin 3s;
        }

        #menu ul {
            font-size: 24px;
            font-family: steelfishEb;
            list-style-type: none;
            display: inline;
        }

        #menu ul li {
            float: left;
            margin: 0px 10px;
            padding: 0 10px 5px 10px;
            text-align: center;
            cursor: pointer;
        }

        #menu ul li:hover {
            border-bottom: 5px solid #ffe200;
        }

        #menu ul li a {
            color: #ffe200;
            text-decoration: none
        }

        #menu ul li.active {
            border-bottom: 5px solid #ffe200;
        }

        @font-face {
            font-family: steelfishEb;
            src: url(assets/steelfish_eb.otf);
        }

        @font-face {
            font-family: bahnschrift;
            src: url(assets/bahnschrift.ttf);
        }

        .dropdown-link {
            float: left;
            width: 100%;
            color: #ffe200;
            text-decoration: none;
            font-size: 24px;
            font-family: steelfishEb;
            text-align: center;
            padding: 10px 0px;
            border: 1px solid;
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
        }

        .thumbnail-videos {
            position: absolute;
            bottom: 10px;
            left: 10px;
            height: 105px;
        }

        .thumb-video {
            float: left;
            margin: 0 5px;
            height: 80px;
            width: 140px;
            background: red;
            cursor: pointer;
            overflow: hidden;
            outline: 1px solid #ffffff;
        }

        .stopped::after {
            content: url(assets/play.png);
            margin: 20px auto;
            display: block;
            width: 40px;
            height: 40px;
        }

        .currentVideo {
            outline: 3px solid #b29813 !important;
        }

        .header-container {
            height: 60px;
            border-bottom: 1px solid #e6ebf0;
            padding: 0 45px;
        }

        .header {
            width: 1260px;
            height: 100%;
            position: relative;
            margin: 0 auto;
        }

        .header img {
            padding: 10px 0 0 0
        }

        .container {
            padding: 20px 0px;
            position: relative;
            margin: 0 auto;
            width: 1260px;
            display: block;
        }

        body {
            margin: 0
        }

        .wireframe-right {
            background: #e6ebf0;
            width: 270px;
            height: 550px;
            float: left;
            margin: 10px 0 0 0;
        }
    </style>
</head>

<body>
    <div class="header-container">
        <div class="header">
            <img src="assets/demo/vidoomy.png">
        </div>
    </div>
    <div class="container">
        <div class="title">
            <img src="assets/demo/wireframe-title.png" alt="">
        </div>
        <div class="wrapper" id="wrapper" style="width:970px;height:550px;position: relative;margin: 10px 10px 10px 0px;
        float: left;">
            <div class="big-video">
                <video id="video-id" current-video="1" muted>
                    <source src="assets/videos/video1.mp4" type="video/mp4" />
                </video>
            </div>
            <div class="thumbnail-videos" id="thumbnail-videos">
                <div class="thumb-video currentVideo" id="thumb-video-1" data-src="assets/videos/video1.mp4"
                    style="background-image:url('assets/thumb1.png')">
                </div>
                <div class="thumb-video stopped" id="thumb-video-2" data-src="assets/videos/video2.mp4"
                    style="background-image:url('assets/thumb2.png')">
                </div>
                <div class="thumb-video stopped" id="thumb-video-3" data-src="assets/videos/video3.mp4"
                    style="background-image:url('assets/thumb3.png')">
                </div>
            </div>
        </div>
        <div class="wireframe-right"></div>
        <div class="wireframe-bottom">
            <img src="assets/demo/wireframe-bottom.png">
        </div>
    </div>

    <script>
        var firstPlay = true
        var completedTransition = false
        var completedAd = false

        var width = "970px"
        var height = "550px"

        var newWidth = "640px"
        var newHeight = "360px"

        var marginTop = "60px"
        var marginLeft = '10px'
        var muted = true

        var hidePlayerButtons = function () {
            var hide = "display:none"

            var fullscreen = document.getElementById('video-id_fluid_control_fullscreen')
            fullscreen.style = hide
            var theatre = document.getElementById('video-id_fluid_control_theatre')
            theatre.style = hide
            var progress = document.getElementById('video-id_fluid_control_duration')
            progress.style = hide
        }

        var showPlayerButtons = function () {
            var show = "display:block"

            var fullscreen = document.getElementById('video-id_fluid_control_fullscreen')
            fullscreen.style = show
            var theatre = document.getElementById('video-id_fluid_control_theatre')
            theatre.style = show
            var progress = document.getElementById('video-id_fluid_control_duration')
            progress.style = show
        }

        var removeAllListener = function () {
            wrapper.removeEventListener("mouseleave", playerOut)
            wrapper.removeEventListener("mouseenter", playerIn)
        }

        var playerOut = function () {
            var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
            removeIfExists(['saveCalendarDropdown'])
            document.getElementsByClassName('active')[0].classList.remove('active')
            document.getElementById('videosItem').classList.add('active')
            // si no ha terminado la transicion, vuelve al tamaño inicial
            if (!completedTransition) {
                video_wrapper.style.width = width
                video_wrapper.style.height = height
                video_wrapper.style.marginTop = "0px"
                video_wrapper.style.marginLeft = '0px'
            }
        }

        var playerIn = function () {
            document.getElementById('paper').style.display = 'none'
            video.muteToggle('video-id', true)
            document.getElementById('video-id_fluid_controls_container').style.display = 'block'
            //video.play()
            var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
            video_wrapper.style.width = newWidth
            video_wrapper.style.height = newHeight
            video_wrapper.style.marginTop = marginTop
            video_wrapper.style.marginLeft = marginLeft
        }

        var removeIfExists = function (ids) {
            ids.map(id => {
                document.getElementById(id) ? document.getElementById(id).remove() : null
            })
        }

        var options = {
            layoutControls: {
                primaryColor: "#d9c408",
                posterImage: "assets/poster.png",
                playButtonShowing: true,
                persistentSettings: {
                    volume: false
                },
                autoPlay: false,
                mute: true,
                playerInitCallback: (function () {

                    hidePlayerButtons()

                    document.getElementById('video-id_fluid_controls_container').style.display = 'none'
                    document.getElementById('video-id_fluid_initial_play').style =
                        'cursor:none;display:none'

                    var unmuteButton = document.createElement('div')

                    unmuteButton.innerHTML = '<img src="assets/unmute.png">'
                    unmuteButton.id = 'video-id_fluid_initial_play'

                    var initial_play = document.getElementById('video-id_fluid_initial_play_button')

                    initial_play.insertBefore(unmuteButton, initial_play.firstChild)

                    var paper = document.createElement('img')
                    paper.src = 'assets/paper.png'
                    paper.style = 'position: absolute;bottom: 0px;right: 0px;z-index: 99;cursor:pointer'
                    paper.id = 'paper'
                    paper.addEventListener('click', function () {
                        document.getElementById('paper').style.display = 'none'
                        video.muteToggle('video-id', true)
                        document.getElementById('video-id_fluid_controls_container').style.display =
                            'block'
                        video.play()
                        var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
                        video_wrapper.style.width = newWidth
                        video_wrapper.style.height = newHeight
                        video_wrapper.style.marginTop = marginTop
                        video_wrapper.style.marginLeft = marginLeft
                        removeAllListener()
                    })
                    document.getElementById('fluid_video_wrapper_video-id').appendChild(paper)

                    // obtenemos el contenedor del reproductor
                    var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')

                    // si el reproductor ya se achicó en el siguiente bucle mantendra el tamaño
                    if (!completedTransition) {
                        video_wrapper.style = "position: absolute;width: " + width + ";height: " + height +
                            ";z-index: 10;"
                    } else {
                        video_wrapper.style = "position: absolute;width: " + newWidth + ";height: " +
                            newHeight + ";z-index: 10;"
                    }

                    // si el primer bucle, agregamos el HTML del fondo
                    if (firstPlay) {
                        var background = document.createElement('div')
                        var bannerRight = document.createElement('div')
                        var logo = document.createElement('img')
                        var logoTop = document.createElement('img')
                        var date = document.createElement('img')
                        var powered = document.createElement('img')
                        var close = document.createElement('img')
                        var rrss = document.createElement('div')
                        var rrss_links = document.createElement('div')
                        var menu = document.createElement('div')

                        background.style = "background-image:url('assets/background.png');width:" + width +
                            ";height:" + height + ";background-repeat: no-repeat;"

                        logo.src = 'assets/logo.png'
                        logoTop.src = 'assets/logo.png'
                        logoTop.style = 'position:absolute;top:10px;left:10px;width: 100px;'

                        date.src = 'assets/date.png'
                        date.style = 'margin-top: 20px;'

                        close.src = 'assets/close.png'
                        close.style = 'position:absolute;top:10px;right:10px;cursor: pointer;'
                        close.id = 'closeButton'

                        bannerRight.style =
                            'position: absolute;right: 50px;bottom: 130px;width: 220px;text-align: center;'

                        powered.src = 'assets/powered.png'
                        powered.style = 'position:absolute;bottom:10px;right:10px'

                        rrss.innerHTML = '#HELLBOY'
                        rrss.style =
                            '    position: absolute;top: 6px;left: 130px;letter-spacing: 5px;color: rgb(255, 226, 0);font-family: steelfishEb;font-size: 20px;width: 100px;text-align: center;'

                        rrssHTML = ''
                        rrssHTML +=
                            '<a href="https://www.facebook.com/hellboymovie/" style="float:left" target="_blank"><img src="assets/fb.png"/></a>'
                        rrssHTML +=
                            '<a href="https://twitter.com/hellboymovie" style="float:left;margin: 0px 20px;" target="_blank"><img src="assets/tw.png"/></a>'
                        rrssHTML +=
                            '<a href="https://www.instagram.com/hellboymovie" style="float:left" target="_blank"><img src="assets/ig.png"/></a>'

                        rrss_links.style.marginLeft = '5px'
                        rrss_links.innerHTML = rrssHTML

                        rrss.appendChild(rrss_links)

                        bannerRight.appendChild(logo)
                        bannerRight.appendChild(date)

                        menu.style = 'position:absolute;right:20px;top:10px'

                        var menuHTML = ''

                        menuHTML = '<ul>'
                        menuHTML += '<li class="active" id="videosItem"><a href="#">Videos</a></li>'
                        menuHTML += '<li id="saveCalendarItem"><a href="#">Guardar en calendario</a></li>'
                        menuHTML += '<li id="synopsisItem"><a href="#">Sinopsis</a></li>'
                        menuHTML += '</ul>'

                        menu.innerHTML = menuHTML
                        menu.id = "menu"

                        wrapper.appendChild(menu)
                        wrapper.appendChild(rrss)
                        wrapper.appendChild(logoTop)
                        wrapper.appendChild(close)
                        wrapper.appendChild(powered)
                        wrapper.appendChild(bannerRight)
                        wrapper.appendChild(background)

                        close.addEventListener('click', function(){
                            //removeIfExists(['header', 'visitPageButton', 'poweredbyvidoomy', 'bottom_container','menu'])
                            playerOut()
                            removeAllListener()
                            document.getElementById('video-id_fluid_controls_container').style.display = 'none'
                            document.getElementById('video-id_fluid_initial_play').style =
                        'cursor:none;display:none'
                            video.pause()
                        })

                        document.getElementById('synopsisItem').addEventListener('click', function (e) {
                            document.getElementById('video-id').pause()

                            e.preventDefault()

                            removeIfExists(['saveCalendarDropdown'])

                            document.getElementsByClassName('active')[0].classList.remove('active')
                            document.getElementById('synopsisItem').classList.add('active')

                            video_wrapper.style.display = 'none'
                            bannerRight.style.display = 'none'
                            document.getElementById('thumbnail-videos').style.display = 'none'

                            if (!document.getElementById('synopsis')) {

                                var synopsis = document.createElement('div')
                                var VisitPageButton = document.createElement('a')
                                var date1 = document.createElement('img')

                                synopsis.style =
                                    'position: absolute;top: 80px;left: 50px;color: white;width: 600px;font-size: 14px;font-family: bahnschrift;text-transform: uppercase;line-height: 25px;'
                                synopsis.id = 'synopsis'
                                var synopsisHTML = ''
                                synopsisHTML +=
                                    '<p style="font-size: 25px;margin-bottom: 0px;color: #ffe100;">Vuelve Hellboy,</p>'
                                synopsisHTML +=
                                    "<p>el gran demonio de piel roja, con cola, cuernos y un brazo de piedra. Atrapado entre los mundos de lo sobrenatural y lo humano, el apodado como 'El más grande Investigador de lo Paranormal del Mundo' junto con la Agencia para la Investigación y Defensa Paranormal (A.I.D.P.) tendrán un nuevo y peligroso desafío. Su misión será enfrentarse a una nueva y poderosa amenaza: Nimue (Milla Jovovich), conocida como La Reina de la Sangre, un espíritu ancestral de la época del rey Arturo que ha vuelto a nuestro mundo llena de sed de venganza para sembrar el terror y destruir a la raza humana.</p>"
                                synopsis.innerHTML = synopsisHTML

                                VisitPageButton.style =
                                    'position: absolute;bottom: 60px;left: 60px;width: 200px;height: 45px;border: 1px solid #ffe100;color: #ffe100;font-size: 16px;font-family: bahnschrift;text-transform: uppercase;text-align: center;line-height: 45px;cursor: pointer;text-decoration: none;'

                                VisitPageButton.innerText = 'Visitar pagina web'
                                VisitPageButton.href = 'https://www.hellboy.movie/'
                                VisitPageButton.target = '_blank'
                                VisitPageButton.id = 'visitPageButton'

                                date1.src = 'assets/date.png'
                                date1.style =
                                    'position: relative;bottom: 130px;margin: 0 auto;display: block;'
                                date1.id = 'date'

                                wrapper.appendChild(date1)
                                wrapper.appendChild(VisitPageButton)
                                wrapper.appendChild(synopsis)

                                removeAllListener()
                            }
                        })

                        document.getElementById('videosItem').addEventListener('click', function (e) {

                            e.preventDefault()
                            document.getElementsByClassName('active')[0].classList.remove('active')
                            document.getElementById('videosItem').classList.add('active')

                            removeIfExists(['saveCalendarDropdown', 'synopsis', 'date',
                                'visitPageButton'
                            ])

                            video_wrapper.style.display = 'block'
                            bannerRight.style.display = 'block'
                            document.getElementById('thumbnail-videos').style.display = 'block'
                        })

                        document.getElementById('saveCalendarItem').addEventListener('click', function (e) {
                            e.preventDefault()

                            if (!document.getElementById('saveCalendarDropdown')) {
                                document.getElementsByClassName('active')[0].classList.remove(
                                    'active')
                                document.getElementById('saveCalendarItem').classList.add('active')

                                var dropdown = document.createElement('div')
                                dropdown.style =
                                    'background: rgb(0, 0, 0);width: 260px;height: 153px;position: absolute;top: 60px;right: 100px;z-index: 99;'
                                dropdown.id = "saveCalendarDropdown"
                                dropdownHTML = ''
                                dropdownHTML +=
                                    '<a href="#" class="dropdown-link">Google Calendar</a>'
                                dropdownHTML += '<a href="#" class="dropdown-link">Apple iCal</a>'
                                dropdownHTML +=
                                    '<a href="#" class="dropdown-link">Microsoft Outlook</a>'
                                dropdown.innerHTML = dropdownHTML
                                wrapper.appendChild(dropdown)
                            } else {
                                document.getElementById('saveCalendarDropdown').remove()

                                document.getElementById('saveCalendarItem').classList.remove(
                                    'active')

                                if (document.getElementById('synopsis')) {
                                    document.getElementById('fluid_video_wrapper_video-id').style
                                        .display

                                    document.getElementById('synopsisItem').classList.add(
                                        'active')

                                } else {
                                    document.getElementById('videosItem').classList.add(
                                        'active')
                                }
                            }
                        })
                    }

                    // agregamos el listener para cuando termine de achicarse
                    video_wrapper.addEventListener("transitionend", function (event) {
                        if (event.propertyName === "width") {
                            if (event.elapsedTime <= 3 && video_wrapper.style.width === width) {
                                document.getElementById('paper').style.display = 'block'
                                //completedTransition = true
                            }
                        }
                    });

                    // agregamos el listener para cuando el mouse salga del reproductor
                    wrapper.addEventListener("mouseleave", playerOut)

                    firstPlay = false
                })
            }
        }


        var video = fluidPlayer("video-id", options);

        video.on('pause', function () {
            var unmute = document.getElementById('video-id_fluid_initial_play')
            if (unmute.classList[0] != 'fluid_initial_play') {
                unmute.remove()
                document.getElementById('video-id_fluid_initial_play').style =
                    'display:block;background:#d9c408'
            }
        })

        video.on('play', function () {
            if (!completedAd) {
                var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
                // agregamos el listener para cuando el mouse este dentro de reproductor
                wrapper.addEventListener("mouseenter", playerIn);
            }
        })

        video.on('ended', function () {
            var videoPlayer = document.getElementById('video-id')

            var nextVideo = document.getElementById('thumb-video-' + (parseInt(videoPlayer.getAttribute(
                "current-video")) + 1))
            var prevVideo = document.getElementById('thumb-video-' + parseInt(videoPlayer.getAttribute(
                "current-video")))


            if ((parseInt(videoPlayer.getAttribute("current-video")) + 1) <= document.getElementsByClassName(
                    'thumb-video').length) {

                nextVideo.classList.remove('stopped')
                prevVideo.classList.add('stopped')

                nextVideo.classList.add('currentVideo')
                prevVideo.classList.remove('currentVideo')

                videoPlayer.src = nextVideo.getAttribute('data-src');
                videoPlayer.setAttribute('current-video', (parseInt(videoPlayer.getAttribute("current-video")) +
                    1))
                videoPlayer.play();
                removeAllListener();
                playerIn();
            } else {
                videoPlayer.pause()
                removeAllListener();
            }

        })

        var videoThumbs = document.getElementsByClassName('thumb-video')

        for (let elem of videoThumbs) {
            elem.addEventListener('click', function (e) {

                var unmute = document.getElementById('video-id_fluid_initial_play')
                if (unmute.classList[0] != 'fluid_initial_play') {
                    unmute.remove()
                    document.getElementById('video-id_fluid_initial_play').style =
                        'display:block;background:#d9c408'
                }

                var videoPlayer = document.getElementById('video-id')

                var nextVideo = document.getElementById('thumb-video-' + parseInt(e.target.id.substr(-1)))
                var prevVideo = document.getElementById('thumb-video-' + parseInt(videoPlayer.getAttribute(
                    "current-video")))

                nextVideo.classList.add('currentVideo')
                prevVideo.classList.remove('currentVideo')

                nextVideo.classList.remove('stopped')
                prevVideo.classList.add('stopped')


                videoPlayer.src = elem.getAttribute("data-src")
                videoPlayer.setAttribute('current-video', parseInt(e.target.id.substr(-1)))

                video.play()
            })
        }
    </script>

</body>

</html>