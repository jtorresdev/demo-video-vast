<link rel="stylesheet" href="https://cdn.fluidplayer.com/v2/current/fluidplayer.min.css" type="text/css" />
<script src="fluidplayer.js"></script>
<style>
    .fluid_video_wrapper {
        -webkit-transition: width 3s, height 3s, margin 3s;
        /* Safari */
        transition: width 3s, height 3s, margin 3s;
    }

    .thumbnail-videos {
        position: absolute;
        bottom: 10px;
        left: 20px;
        height: 105px;
    }

    .thumb-video {
        float: left;
        margin: 0 5px;
        height: 100px;
        width: 180px;
        background: red;
        cursor: pointer
    }
</style>

<div class="wrapper" id="wrapper" style="width:970px;height:550px;position: relative;">
    <div class="big-video">
        <video id="video-id" current-video="1">
            <source src="https://iab-publicfiles.s3.amazonaws.com/vast/VAST-4.0-Short-Intro.mp4" type="video/mp4" />
        </video>
    </div>

    <div class="thumbnail-videos">
        <div class="thumb-video" id="thumb-video-1"
            data-src="https://iab-publicfiles.s3.amazonaws.com/vast/VAST-4.0-Short-Intro.mp4">
            <!-- thumb -->
        </div>
        <div class="thumb-video" id="thumb-video-2" data-src="video.mp4">
            <!-- thumb -->
        </div>
        <div class="thumb-video" id="thumb-video-3"
            data-src="https://iab-publicfiles.s3.amazonaws.com/vast/VAST-4.0-Short-Intro.mp4">
            <!-- thumb -->
        </div>
    </div>

</div>

<script>
    var firstPlay = true
    var completedTransition = false
    var completedAd = false

    var width = "970px"
    var height = "550px"

    var newWidth = "640px"
    var newHeight = "360px"

    var marginTop = "60px"

    var hidePlayerButtons = function () {
        var hide = "display:none"

        var fullscreen = document.getElementById('video-id_fluid_control_fullscreen')
        fullscreen.style = hide
        var theatre = document.getElementById('video-id_fluid_control_theatre')
        theatre.style = hide
        var progress = document.getElementById('video-id_fluid_control_duration')
        progress.style = hide
    }

    var showPlayerButtons = function () {
        var show = "display:block"

        var fullscreen = document.getElementById('video-id_fluid_control_fullscreen')
        fullscreen.style = show
        var theatre = document.getElementById('video-id_fluid_control_theatre')
        theatre.style = show
        var progress = document.getElementById('video-id_fluid_control_duration')
        progress.style = show
    }

    var removeAllListener = function () {
        wrapper.removeEventListener("mouseleave", playerOut)
        wrapper.removeEventListener("mouseenter", playerIn)
    }

    var playerOut = function () {
        var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
        // si no ha terminado la transicion, vuelve al tamaño inicial
        if (!completedTransition) {
            video_wrapper.style.width = width
            video_wrapper.style.height = height
            video_wrapper.style.marginTop = "0px"
        }
    }

    var playerIn = function () {
        var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
        video_wrapper.style.width = newWidth
        video_wrapper.style.height = newHeight
        video_wrapper.style.marginTop = marginTop
    }


    var options = {
        layoutControls: {
            playerInitCallback: (function () {
                // obtenemos el contenedor del reproductor
                var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')

                // si el reproductor ya se achicó en el siguiente bucle mantendra el tamaño
                if (!completedTransition) {
                    video_wrapper.style = "position: absolute;width: " + width + ";height: " + height +
                        ";z-index: 10;"
                } else {
                    video_wrapper.style = "position: absolute;width: " + newWidth + ";height: " +
                        newHeight + ";z-index: 10;"
                }

                // si el primer bucle, agregamos el HTML del fondo
                if (firstPlay) {
                    var background = document.createElement('div')
                    background.style = "background:gray;width:" + width + ";height:" + height + ""
                    wrapper.appendChild(background)
                }

                // agregamos el listener para cuando termine de achicarse
                video_wrapper.addEventListener("transitionend", function (event) {
                    if (event.propertyName === "width") {
                        if (event.elapsedTime > 2.8) {
                            completedTransition = true
                        }
                    }
                });

                // agregamos el listener para cuando el mouse salga del reproductor
                wrapper.addEventListener("mouseleave", playerOut)

                firstPlay = false
            })
        }
    }


    var video = fluidPlayer("video-id", options);

    var resetPlayer = function () {
        // iniciamos una nueva instancia del reproductor
        fluidPlayer('video-id', options);
    };

    video.on('play', function () {
        if (!completedAd) {
            var video_wrapper = document.getElementById('fluid_video_wrapper_video-id')
            // agregamos el listener para cuando el mouse este dentro de reproductor
            wrapper.addEventListener("mouseenter", playerIn);
        }
    })

    video.on('ended', function () {
        var videoPlayer = document.getElementById('video-id')
        var nextVideo = parseInt(videoPlayer.getAttribute("current-video")) + 1
        if(nextVideo <= document.getElementsByClassName('thumb-video').length){
            videoPlayer.src =  document.getElementById('thumb-video-' + nextVideo).getAttribute('data-src');
            videoPlayer.setAttribute('current-video', nextVideo) 
            videoPlayer.play();
        }
        removeAllListener();
        playerIn();
    })

    var videoThumbs = document.getElementsByClassName('thumb-video')

    for (let elem of videoThumbs) {
        elem.addEventListener('click', function (e) {
            var videoPlayer = document.getElementById('video-id')
            videoPlayer.src = elem.getAttribute("data-src")
            video.play()
        })
    }
</script>